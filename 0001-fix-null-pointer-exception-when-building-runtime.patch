From 25def43b506700f718b1e1bc476abae4c31c7185 Mon Sep 17 00:00:00 2001
From: wrj97 <wurongjie@deepin.org>
Date: Mon, 25 Aug 2025 13:38:04 +0800
Subject: [PATCH] fix: null pointer exception when building runtime
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

在构建runtime时会出现空指针异常的问题
---
 libs/linglong/src/linglong/builder/linglong_builder.cpp | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/libs/linglong/src/linglong/builder/linglong_builder.cpp b/libs/linglong/src/linglong/builder/linglong_builder.cpp
index 638e577a..82b4f62d 100644
--- a/libs/linglong/src/linglong/builder/linglong_builder.cpp
+++ b/libs/linglong/src/linglong/builder/linglong_builder.cpp
@@ -769,7 +769,7 @@ utils::error::Result<void> Builder::processBuildDepends() noexcept
       .appendEnv("LINYAPS_INIT_SINGLE_MODE", "1");
 
     // overwrite runtime overlay directory
-    if (cfgBuilder.getRuntimePath()) {
+    if (cfgBuilder.getRuntimePath() && runtimeOverlay) {
         cfgBuilder.setRuntimePath(runtimeOverlay->mergedDirPath().toStdString(), false);
     }
 
@@ -908,7 +908,7 @@ utils::error::Result<bool> Builder::buildStageBuild(const QStringList &args) noe
         cfgBuilder.isolateNetWork();
     }
 
-    if (cfgBuilder.getRuntimePath()) {
+    if (cfgBuilder.getRuntimePath() && runtimeOverlay) {
         cfgBuilder.setRuntimePath(runtimeOverlay->mergedDirPath().toStdString(), false);
     }
 
@@ -1051,7 +1051,7 @@ utils::error::Result<void> Builder::buildStagePreCommit() noexcept
       .forwardDefaultEnv()
       .appendEnv("LINYAPS_INIT_SINGLE_MODE", "1");
 
-    if (cfgBuilder.getRuntimePath()) {
+    if (cfgBuilder.getRuntimePath() && runtimeOverlay) {
         cfgBuilder.setRuntimePath(runtimeOverlay->mergedDirPath().toStdString(), false);
     }
 
-- 
2.51.0

