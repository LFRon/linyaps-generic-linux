From 42d68c29be356c96c3725ebde350b0c16a2b577b Mon Sep 17 00:00:00 2001
From: wrj97 <wurongjie@deepin.org>
Date: Mon, 25 Aug 2025 13:38:04 +0800
Subject: [PATCH] fix: null pointer exception when building runtime
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

在构建runtime时会出现空指针异常的问题
---
 libs/linglong/src/linglong/builder/linglong_builder.cpp | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/libs/linglong/src/linglong/builder/linglong_builder.cpp b/libs/linglong/src/linglong/builder/linglong_builder.cpp
index f559845b..77b8d749 100644
--- a/libs/linglong/src/linglong/builder/linglong_builder.cpp
+++ b/libs/linglong/src/linglong/builder/linglong_builder.cpp
@@ -768,6 +768,6 @@ utils::error::Result<void> Builder::processBuildDepends() noexcept
 
     // overwrite runtime overlay directory
-    if (cfgBuilder.getRuntimePath()) {
+    if (cfgBuilder.getRuntimePath() && runtimeOverlay) {
         cfgBuilder.setRuntimePath(runtimeOverlay->mergedDirPath().toStdString(), false);
     }
 
@@ -899,7 +899,7 @@ utils::error::Result<bool> Builder::buildStageBuild(const QStringList &args) noe
         cfgBuilder.isolateNetWork();
     }
 
-    if (cfgBuilder.getRuntimePath()) {
+    if (cfgBuilder.getRuntimePath() && runtimeOverlay) {
         cfgBuilder.setRuntimePath(runtimeOverlay->mergedDirPath().toStdString(), false);
     }
 
@@ -1040,6 +1040,6 @@ utils::error::Result<void> Builder::buildStagePreCommit() noexcept
       .forwardDefaultEnv();
 
-    if (cfgBuilder.getRuntimePath()) {
+    if (cfgBuilder.getRuntimePath() && runtimeOverlay) {
         cfgBuilder.setRuntimePath(runtimeOverlay->mergedDirPath().toStdString(), false);
     }
 
-- 
2.50.1

